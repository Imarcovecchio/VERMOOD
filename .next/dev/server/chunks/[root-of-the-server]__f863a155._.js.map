{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/ignacio/vermut-landing/app/api/create-preference/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json()\n    const { nombre, email, phone, plan } = body\n\n    console.log(\"[v0] Datos recibidos:\", { nombre, email, phone, plan })\n\n    // Precios según el plan\n    const prices: Record<string, number> = {\n      clasica: 8500,\n      premium: 12500,\n      elite: 22500,\n    }\n\n    const planNames: Record<string, string> = {\n      clasica: \"Membresía Clásica\",\n      premium: \"Membresía Premium\",\n      elite: \"Membresía Elite\",\n    }\n\n    const price = prices[plan] || 8500\n    const planName = planNames[plan] || \"Membresía Clásica\"\n\n    console.log(\"[v0] Plan seleccionado:\", planName, \"- Precio:\", price)\n\n    const baseUrl = process.env.NEXT_PUBLIC_SITE_URL || process.env.BASE_URL\n\n    // Crear la preferencia de pago en Mercado Pago\n    const preference = {\n      items: [\n        {\n          title: planName,\n          quantity: 1,\n          unit_price: price,\n          currency_id: \"ARS\",\n        },\n      ],\n      payer: {\n        name: nombre,\n        email: email,\n        phone: {\n          number: phone,\n        },\n      },\n      back_urls: {\n        success: `${baseUrl}${process.env.SUCCESS_PATH || \"/pago/exito\"}`,\n        failure: `${baseUrl}${process.env.FAILURE_PATH || \"/pago/fallo\"}`,\n        pending: `${baseUrl}${process.env.PENDING_PATH || \"/pago/pendiente\"}`,\n      },\n      auto_return: \"approved\",\n      external_reference: JSON.stringify({ nombre, email, phone, plan }),\n      notification_url: `${baseUrl}/api/webhooks/mercadopago`,\n    }\n\n    console.log(\"[v0] Enviando preferencia a Mercado Pago...\")\n\n    const response = await fetch(\"https://api.mercadopago.com/checkout/preferences\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${process.env.MERCADOPAGO_ACCESS_TOKEN}`,\n      },\n      body: JSON.stringify(preference),\n    })\n\n    const data = await response.json()\n\n    if (!response.ok) {\n      throw new Error(\"Error en Mercado Pago: \" + JSON.stringify(data))\n    }\n\n    console.log(\"[v0] Preferencia creada exitosamente:\", data.id)\n\n    return NextResponse.json({\n      id: data.id,\n      init_point: data.init_point,\n    })\n  } catch (error: any) {\n    console.error(\"[v0] Error crear preferencia:\", error)\n    return NextResponse.json({ error: error.message }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG;QAEvC,QAAQ,GAAG,CAAC,yBAAyB;YAAE;YAAQ;YAAO;YAAO;QAAK;QAElE,wBAAwB;QACxB,MAAM,SAAiC;YACrC,SAAS;YACT,SAAS;YACT,OAAO;QACT;QAEA,MAAM,YAAoC;YACxC,SAAS;YACT,SAAS;YACT,OAAO;QACT;QAEA,MAAM,QAAQ,MAAM,CAAC,KAAK,IAAI;QAC9B,MAAM,WAAW,SAAS,CAAC,KAAK,IAAI;QAEpC,QAAQ,GAAG,CAAC,2BAA2B,UAAU,aAAa;QAE9D,MAAM,UAAU,QAAQ,GAAG,CAAC,oBAAoB,IAAI,QAAQ,GAAG,CAAC,QAAQ;QAExE,+CAA+C;QAC/C,MAAM,aAAa;YACjB,OAAO;gBACL;oBACE,OAAO;oBACP,UAAU;oBACV,YAAY;oBACZ,aAAa;gBACf;aACD;YACD,OAAO;gBACL,MAAM;gBACN,OAAO;gBACP,OAAO;oBACL,QAAQ;gBACV;YACF;YACA,WAAW;gBACT,SAAS,GAAG,UAAU,QAAQ,GAAG,CAAC,YAAY,IAAI,eAAe;gBACjE,SAAS,GAAG,UAAU,QAAQ,GAAG,CAAC,YAAY,IAAI,eAAe;gBACjE,SAAS,GAAG,UAAU,QAAQ,GAAG,CAAC,YAAY,IAAI,mBAAmB;YACvE;YACA,aAAa;YACb,oBAAoB,KAAK,SAAS,CAAC;gBAAE;gBAAQ;gBAAO;gBAAO;YAAK;YAChE,kBAAkB,GAAG,QAAQ,yBAAyB,CAAC;QACzD;QAEA,QAAQ,GAAG,CAAC;QAEZ,MAAM,WAAW,MAAM,MAAM,oDAAoD;YAC/E,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,eAAe,CAAC,OAAO,EAAE,QAAQ,GAAG,CAAC,wBAAwB,EAAE;YACjE;YACA,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM,4BAA4B,KAAK,SAAS,CAAC;QAC7D;QAEA,QAAQ,GAAG,CAAC,yCAAyC,KAAK,EAAE;QAE5D,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,IAAI,KAAK,EAAE;YACX,YAAY,KAAK,UAAU;QAC7B;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACF"}}]
}